# Club Anti-Zapret - Улучшение подключения к сервисам для компьютерных клубов

## Обзор проекта

Club Anti-Zapret - это набор PowerShell-скриптов, предназначенный для автоматического и скрытного улучшения подключения к сервисам в компьютерных клубах. Основной скрипт использует инструменты `zapret-discord-youtube` версии 1.8.5 для обеспечения стабильного доступа к сервисам, включая Discord, YouTube и другие.

Скрипт реализует архитектуру автоматической загрузки, запуска и улучшения подключения. Он автоматически:

- Загружает и распаковывает необходимые инструменты улучшения подключения
- Запускает скрипт `general (FAKE TLS AUTO).bat` для оптимальной эффективности улучшения подключения
- Запускает целевое приложение (например, Discord) с правильными аргументами
- Работает в скрытом режиме, скрывая процесс улучшения подключения от пользователей
- Автоматически завершает работу и очищает временные файлы после закрытия приложения
- Включает улучшенную систему уведомлений современным дизайном в стиле Discord

## Особенности

- **Автоматическая загрузка**: Скрипт автоматически загружает необходимые инструменты улучшения подключения из GitHub
- **Скрытый режим работы**: Работает в фоновом режиме без отображения окон
- **Улучшенное завершение**: После завершения работы приложения скрипт завершает процессы улучшения подключения, но не удаляет временные файлы (они очищаются системой автоматически)
- **Гибкая настройка**: Поддерживает настройку через параметры командной строки
- **Обнаружение приложений**: Автоматически находит установленные приложения (Discord, YouTube и др.) в стандартных директориях
- **Обработка ошибок**: Включает надежную обработку ошибок и логирование
- **Улучшенная визуализация**: Включает современное модальное уведомление в стиле Discord с возможностью перетаскивания
- **Защита от дубликатов**: Использует мьютекс для предотвращения запуска нескольких экземпляров скрипта
- **Улучшенная проверка инициализации**: Более точная проверка готовности улучшения подключения к работе
- **Улучшенная очистка процессов**: Более тщательное завершение процессов улучшения подключения и Discord

## Установка

### Рекомендуемый способ: Установка с помощью CreateDiscordShortcut.ps1

В проекте предоставляется скрипт `CreateDiscordShortcut.ps1`, который автоматически:
- Создает директорию для хранения скрипта в `%LOCALAPPDATA%\DiscordEnhancedConnectivity`
- Загружает последнюю версию `DiscordEnhancedConnectivity.ps1` из GitHub репозитория
- Удаляет существующий ярлык Discord с рабочего стола (если есть)
- Ищет установленный Discord для получения иконки
- Создает новый ярлык на рабочем столе с правильными параметрами запуска

Для использования:
1. Скачайте файл `CreateDiscordShortcut.ps1` из репозитория
2. Запустите его от имени администратора:
   ```powershell
   .\CreateDiscordShortcut.ps1
   ```
   > **Примечание**: Можно также запустить скрипт через контекстное меню, нажав правой кнопкой мыши на файл и выбрав "Выполнить с помощью PowerShell"

После запуска скрипта на рабочем столе появится ярлык "Discord", который будет использовать улучшение подключения к сервисам. При каждом запуске ярлыка будет автоматически использоваться последняя версия скрипта улучшения подключения.

### Ручная установка

1. Скачайте файл `DiscordEnhancedConnectivity.ps1` из репозитория или создайте его с содержимым предоставленного скрипта.

2. Поместите файл `DiscordEnhancedConnectivity.ps1` в подходящий каталог, например:
   ```
   C:\ClubTools\DiscordEnhancedConnectivity\DiscordEnhancedConnectivity.ps1
   ```

3. Создайте ярлык на рабочем столе:
   - Щелкните правой кнопкой мыши на рабочем столе
   - Выберите "Создать" → "Ярлык"
   - В поле "Путь к объекту" введите следующую команду:
   ```
   powershell.exe -ExecutionPolicy Bypass -File "C:\ClubTools\DiscordEnhancedConnectivity\DiscordEnhancedConnectivity.ps1"
   ```
   - Назовите ярлык "Discord" (или любое другое желаемое имя)

4. Настройте свойства ярлыка:
   - Щелкните правой кнопкой мыши по созданному ярлыку
   - Выберите "Свойства"
   - В поле "Путь к объекту" убедитесь, что команда выглядит так:
   ```
   powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -File "C:\ClubTools\DiscordEnhancedConnectivity\DiscordEnhancedConnectivity.ps1"
   ```
   - Нажмите "ОК" для сохранения изменений

> **Примечание**: Параметр `-WindowStyle Hidden` скрывает окно PowerShell при запуске, обеспечивая скрытную работу скрипта.

### Системные требования

- **Операционная система**: Windows 10/11 (совместим с 64-битными и 32-битными версиями)
- **PowerShell**: Установленная и разрешенная версия PowerShell (обычно встроена в Windows)
- **Интернет-соединение**: Стабильное подключение к интернету для загрузки инструментов улучшения подключения
- **Права доступа**: Возможность запуска скриптов PowerShell (в некоторых системах может потребоваться изменение политики выполнения скриптов)
- **.NET Framework**: Встроенная версия (обычно встроена в Windows)

## Использование

### Параметры и настройки

Скрипт `CreateDiscordShortcut.ps1` не требует параметров для запуска, но можно настроить следующие параметры в коде:
- `$GitHubScriptUrl`: URL для загрузки `DiscordEnhancedConnectivity.ps1`
- `$LocalScriptDir`: Директория для хранения скрипта (по умолчанию `%LOCALAPPDATA%\DiscordEnhancedConnectivity`)
- `$ShortcutPath`: Путь к создаваемому ярлыку (по умолчанию на рабочем столе)

> **Примечание**: Все временные файлы и настройки хранятся изолированно в пользовательской директории, что обеспечивает безопасность и изоляцию от других пользователей системы.

Скрипт `DiscordEnhancedConnectivity.ps1` поддерживает следующие параметры настройки:
- `-DiscordPath`: Путь к исполняемому файлу Discord (если отличается от стандартного)
- `-ConnectivityScript`: Имя скрипта улучшения подключения (по умолчанию "general (FAKE TLS AUTO).bat")

Пример использования параметров:
```powershell
.\DiscordEnhancedConnectivity.ps1 -DiscordPath "C:\CustomPath\Discord\Discord.exe" -ConnectivityScript "custom_connectivity.bat"
```

### Что происходит во время выполнения

1. **Загрузка**: Скрипт загружает архив с инструментами улучшения подключения из GitHub
2. **Извлечение**: Архив извлекается во временный каталог
3. **Запуск улучшения подключения**: Скрипт `general (FAKE TLS AUTO).bat` запускается в фоновом режиме
4. **Инициализация**: Скрипт ожидает инициализации улучшения подключения (до 60 секунд)
5. **Запуск приложения**: Приложение запускается с правильной командой
6. **Мониторинг**: Скрипт ожидает завершения работы приложения
7. **Завершение**: Процесс улучшения подключения завершается и временные файлы очищаются
8. **Показ уведомления**: Показывается современное модальное уведомление в стиле Discord

### Запуск через ярлык

1. Дважды щелкните по созданному ярлыку на рабочем столе
2. Скрипт автоматически:
   - Загрузит и распакует инструменты улучшения подключения
   - Запустит скрипт улучшения подключения в фоновом режиме
   - Запустит Discord с правильной командой
   - Будет ожидать завершения работы Discord
   - Автоматически завершит процесс улучшения подключения и очистит временные файлы

## Конфигурация

Следующие переменные можно изменить в исходном коде скрипта при необходимости:

- `$ReleaseUrl`: URL для загрузки инструментов улучшения подключения
- `$maxDownloadSize`: Максимальный размер загружаемого архива (по умолчанию 50 МБ)
- `$ConnectivityScript`: Имя скрипта улучшения подключения (по умолчанию "general (FAKE TLS AUTO).bat")
- `$mutexName`: Имя мьютекса для предотвращения дублирования процессов


## Зависимости

- `zapret-discord-youtube` - инструменты улучшения подключения (версия 1.8.5)
- PowerShell 5.1 или выше
- .NET Framework (встроенный в Windows)
- System.Windows.Forms (для уведомлений)
- System.Drawing (для стилизации уведомлений)

## Устранение неполадок

### Распространенные проблемы и решения

#### Проблема: "Execution Policy Restricted"

**Симптомы**: Ошибка выполнения скрипта из-за политики выполнения
**Решение**: Запустите PowerShell от имени администратора и выполните:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope LocalMachine
```

#### Проблема: "Discord не найден"

**Симптомы**: Ошибка "Discord не найден в стандартных директориях"
**Решение**: Укажите точный путь к Discord при запуске скрипта:

```powershell
.\DiscordEnhancedConnectivity.ps1 -DiscordPath "C:\Путь\К\Discord\Discord.exe"
```

#### Проблема: "Не удается загрузить архив"

**Симптомы**: Ошибка при загрузке архива улучшения подключения
**Решение**:

- Проверьте подключение к интернету
- Убедитесь, что URL для загрузки доступен
- Проверьте, не блокируется ли доступ к GitHub

#### Проблема: "Процесс улучшения подключения завершился раньше времени"

**Симптомы**: Скрипт завершается с ошибкой инициализации
**Решение**:

- Проверьте, что антивирус не блокирует выполнение
- Убедитесь, что системные требования соблюдены
- Попробуйте запустить скрипт вручную для диагностики

#### Проблема: "Не удается удалить временные файлы"

**Симптомы**: Предупреждение об ошибках при очистке
**Решение**:

- Временные файлы могут остаться в `%TEMP%` каталоге
- Проверьте, не используются ли файлы другими процессами
- Очистите временные файлы вручную при необходимости

### Диагностика

Для диагностики проблем запустите скрипт вручную в PowerShell вместо скрытого режима, чтобы видеть вывод:

```powershell
powershell.exe -File "C:\ClubTools\DiscordEnhancedConnectivity\DiscordEnhancedConnectivity.ps1"
```

## Безопасность

### Обработка временных файлов

Скрипт создает временные файлы в следующем каталоге:

```
%TEMP%\DiscordEnhancedConnectivity_YYYYMMDD
```

Где `YYYYMMDD` - это дата запуска скрипта.

### Завершение работы

После завершения работы целевого приложения скрипт:

- Завершает все процессы улучшения подключения
- Временные файлы остаются на диске и очищаются системой автоматически

### Безопасность загрузки

- Перед загрузкой проверяется размер файла (не более 50 МБ по умолчанию)
- Загрузка производится по HTTPS из надежного источника (GitHub)
- Проверяется целостность загруженного архива

### Скрытие процессов

Скрипт запускает улучшение подключения в скрытом режиме без отображения окон, что:

- Скрывает процесс улучшения подключения от пользователей
- Предотвращает случайное закрытие процессов
- Обеспечивает прозрачную работу для пользователей

## Совместимость

### Совместимость с Windows

Скрипт протестирован и совместим с:

- Windows 10 (64-битные и 32-битные версии)
- Windows 11 (64-битные и 32-битные версии)
- Windows 10/11 с последними обновлениями
- Windows в корпоративной среде

### Требования к версии приложений

Скрипт совместим с:

- Стандартной установкой Discord
- Портативной версией Discord
- Discord PTB (Public Test Build)
- Discord Canary
- Любой версией Discord, установленной в стандартные директории
- YouTube и другими сервисами, поддерживаемыми инструментами zapret

### Совместимость с инструментами улучшения подключения

Скрипт использует `zapret-discord-youtube-1.8.5` и:

- Автоматически загружает необходимую версию
- Совместим с различными скриптами улучшения подключения
- Поддерживает настройку имени скрипта улучшения подключения

## Обслуживание

### Обновление скрипта

Для обновления скрипта до новой версии:

1. Проверьте наличие новой версии инструментов улучшения подключения на GitHub
2. Обновите значение переменной `$ReleaseUrl` в скрипте
3. При необходимости обновите `$ConnectivityScript` на новый скрипт улучшения подключения
4. Протестируйте обновленный скрипт в тестовой среде

### Обновление версии инструментов улучшения подключения

Чтобы использовать новую версию `zapret-discord-youtube`:

1. Измените URL в переменной `$ReleaseUrl`:

```powershell
$ReleaseUrl = "https://github.com/Flowseal/zapret-discord-youtube/releases/download/NEW_VERSION/zapret-discord-youtube-NEW_VERSION.zip"
```

2. Измените имя архива и директории извлечения при необходимости:

```powershell
$ZipPath = Join-Path $TempDir "zapret-discord-youtube-NEW_VERSION.zip"
$ExtractDir = Join-Path $TempDir "zapret-discord-youtube-NEW_VERSION"
```

### Резервное копирование

Перед внесением изменений рекомендуется создать резервную копию:

```cmd
copy "C:\ClubTools\DiscordEnhancedConnectivity\DiscordEnhancedConnectivity.ps1" "C:\ClubTools\DiscordEnhancedConnectivity\DiscordEnhancedConnectivity.ps1.backup"
```

### Мониторинг работоспособности

Рекомендуется периодически проверять:

- Работоспособность скрипта на разных машинах
- Актуальность URL для загрузки инструментов
- Совместимость с новыми версиями приложений
- Эффективность улучшения подключения

## Примеры использования

### Простой запуск

```powershell
.\DiscordEnhancedConnectivity.ps1
```

### Запуск с указанием пути к Discord

```powershell
.\DiscordEnhancedConnectivity.ps1 -DiscordPath "C:\Program Files\Discord.exe"
```

### Запуск с другим скриптом улучшения подключения

```powershell
.\DiscordEnhancedConnectivity.ps1 -ConnectivityScript "windows_service_installer.bat"
```

## Лицензия

Этот проект лицензирован на условиях MIT License - смотрите файл [LICENSE](LICENSE) для получения подробной информации.

## Авторы

- **Flowseal** - оригинальные инструменты улучшения подключения (zapret-discord-youtube)
- **CatSema** - скрипт DiscordEnhancedConnectivity и сопутствующие инструменты

## Благодарности

- Сообществу разработчиков за инструменты и ресурсы, использованные в этом проекте
- Пользователям, которые тестировали и помогали улучшать функциональность
