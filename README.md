# Club Anti-Zapret - Обход ограничений для компьютерных клубов

## Обзор проекта

Club Anti-Zapret - это PowerShell-скрипт, предназначенный для автоматического и скрытного запуска обхода ограничений в компьютерных клубах. Скрипт использует набор инструментов `zapret-discord-youtube` версии 1.8.5 для обеспечения беспрепятственного доступа к заблокированным сервисам, включая Discord, YouTube и другие, в условиях, когда соединение с этими сервисами заблокировано или ограничено.

Скрипт реализует архитектуру автоматической загрузки, запуска и завершения обхода ограничений. Он автоматически:

- Загружает и распаковывает необходимые инструменты обхода ограничений
- Запускает скрипт `general (FAKE TLS AUTO).bat` для оптимальной эффективности обхода
- Запускает целевое приложение (например, Discord) с правильными аргументами
- Работает в скрытом режиме, скрывая процесс обхода от пользователей
- Автоматически завершает работу и очищает временные файлы после закрытия приложения

## Особенности

- **Автоматическая загрузка**: Скрипт автоматически загружает необходимые инструменты обхода из GitHub
- **Скрытый режим работы**: Работает в фоновом режиме без отображения окон
- **Безопасная очистка**: После завершения работы приложения скрипт завершает процессы обхода и очищает временные файлы
- **Гибкая настройка**: Поддерживает настройку через параметры командной строки
- **Обнаружение приложений**: Автоматически находит установленные приложения (Discord, YouTube и др.) в стандартных директориях
- **Обработка ошибок**: Включает надежную обработку ошибок и логирование

## Установка

### Рекомендуемый способ: Установка с помощью CreateDiscordShortcut.ps1

В проекте предоставляется скрипт `CreateDiscordShortcut.ps1`, который автоматически:
- Создает директорию для хранения скрипта в `%LOCALAPPDATA%\DiscordBypass`
- Загружает последнюю версию `DiscordBypass.ps1` из GitHub репозитория
- Удаляет существующий ярлык Discord с рабочего стола (если есть)
- Ищет установленный Discord для получения иконки
- Создает новый ярлык на рабочем столе с правильными параметрами запуска

Для использования:
1. Скачайте файл `CreateDiscordShortcut.ps1` из репозитория
2. Запустите его от имени администратора:
   ```powershell
   .\CreateDiscordShortcut.ps1
   ```
   > **Примечание**: Можно также запустить скрипт через контекстное меню, нажав правой кнопкой мыши на файл и выбрав "Выполнить с помощью PowerShell"

После запуска скрипта на рабочем столе появится ярлык "Discord", который будет использовать обход ограничений. При каждом запуске ярлыка будет автоматически использоваться последняя версия скрипта обхода.

### Ручная установка

1. Скачайте файл `DiscordBypass.ps1` из репозитория или создайте его с содержимым предоставленного скрипта.

2. Поместите файл `DiscordBypass.ps1` в подходящий каталог, например:
   ```
   C:\ClubTools\DiscordBypass\DiscordBypass.ps1
   ```

3. Создайте ярлык на рабочем столе:
   - Щелкните правой кнопкой мыши на рабочем столе
   - Выберите "Создать" → "Ярлык"
   - В поле "Путь к объекту" введите следующую команду:
   ```
   powershell.exe -ExecutionPolicy Bypass -File "C:\ClubTools\DiscordBypass\DiscordBypass.ps1"
   ```
   - Назовите ярлык "Discord" (или любое другое желаемое имя)

4. Настройте свойства ярлыка:
   - Щелкните правой кнопкой мыши по созданному ярлыку
   - Выберите "Свойства"
   - В поле "Путь к объекту" убедитесь, что команда выглядит так:
   ```
   powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -File "C:\ClubTools\DiscordBypass\DiscordBypass.ps1"
   ```
   - Нажмите "ОК" для сохранения изменений

> **Примечание**: Параметр `-WindowStyle Hidden` скрывает окно PowerShell при запуске, обеспечивая скрытную работу скрипта.

### Системные требования

- **Операционная система**: Windows 10/11 (совместим с 64-битными и 32-битными версиями)
- **PowerShell**: Установленная и разрешенная версия PowerShell (обычно встроена в Windows)
- **Интернет-соединение**: Стабильное подключение к интернету для загрузки инструментов обхода
- **Права доступа**: Возможность запуска скриптов PowerShell (в некоторых системах может потребоваться изменение политики выполнения скриптов)

## Использование

### Параметры и настройки

Скрипт `CreateDiscordShortcut.ps1` не требует параметров для запуска, но можно настроить следующие параметры в коде:
- `$GitHubScriptUrl`: URL для загрузки `DiscordBypass.ps1`
- `$LocalScriptDir`: Директория для хранения скрипта (по умолчанию `%LOCALAPPDATA%\DiscordBypass`)
- `$ShortcutPath`: Путь к создаваемому ярлыку (по умолчанию на рабочем столе)

> **Примечание**: Все временные файлы и настройки хранятся изолированно в пользовательской директории, что обеспечивает безопасность и изоляцию от других пользователей системы.

Скрипт `DiscordBypass.ps1` поддерживает следующие параметры настройки:
- `-DiscordPath`: Путь к исполняемому файлу Discord (если отличается от стандартного)
- `-BypassScript`: Имя скрипта обхода (по умолчанию "general (FAKE TLS AUTO).bat")

Пример использования параметров:
```powershell
.\DiscordBypass.ps1 -DiscordPath "C:\CustomPath\Discord\Discord.exe" -BypassScript "custom_bypass.bat"
```

### Что происходит во время выполнения

1. **Загрузка**: Скрипт загружает архив с инструментами обхода ограничений из GitHub
2. **Извлечение**: Архив извлекается во временный каталог
3. **Запуск обхода**: Скрипт `general (FAKE TLS AUTO).bat` запускается в фоновом режиме
4. **Инициализация**: Скрипт ожидает инициализации обхода (до 60 секунд)
5. **Запуск приложения**: Приложение запускается с правильной командой
6. **Мониторинг**: Скрипт ожидает завершения работы приложения
7. **Завершение**: Процесс обхода завершается и временные файлы очищаются

### Запуск через ярлык

1. Дважды щелкните по созданному ярлыку на рабочем столе
2. Скрипт автоматически:
   - Загрузит и распакует инструменты обхода ограничений
   - Запустит скрипт обхода в фоновом режиме
   - Запустит Discord с правильной командой
   - Будет ожидать завершения работы Discord
   - Автоматически завершит процесс обхода и очистит временные файлы


## Конфигурация

Следующие переменные можно изменить в исходном коде скрипта при необходимости:

- `$ReleaseUrl`: URL для загрузки инструментов обхода
- `$maxDownloadSize`: Максимальный размер загружаемого архива (по умолчанию 50 МБ)
- `$BypassScript`: Имя скрипта обхода (по умолчанию "general (FAKE TLS AUTO).bat")

## Тестирование

Проект включает в себя тестовые скрипты для проверки функциональности:

- `test_discord_bypass.ps1` - Основные тесты функциональности
- `test_discord_bypass_improved.ps1` - Тесты улучшенной логики очистки

Для запуска тестов:

```powershell
.\test_discord_bypass.ps1
```

## Зависимости

- `zapret-discord-youtube` - инструменты обхода ограничений
- PowerShell 5.1 или выше
- .NET Framework (встроенный в Windows)

## Устранение неполадок

### Распространенные проблемы и решения

#### Проблема: "Execution Policy Restricted"

**Симптомы**: Ошибка выполнения скрипта из-за политики выполнения
**Решение**: Запустите PowerShell от имени администратора и выполните:

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope LocalMachine
```

#### Проблема: "Discord не найден"

**Симптомы**: Ошибка "Discord не найден в стандартных директориях"
**Решение**: Укажите точный путь к Discord при запуске скрипта:

```powershell
.\DiscordBypass.ps1 -DiscordPath "C:\Путь\К\Discord\Discord.exe"
```

#### Проблема: "Не удается загрузить архив"

**Симптомы**: Ошибка при загрузке архива обхода
**Решение**:

- Проверьте подключение к интернету
- Убедитесь, что URL для загрузки доступен
- Проверьте, не блокируется ли доступ к GitHub

#### Проблема: "Процесс обхода завершился раньше времени"

**Симптомы**: Скрипт завершается с ошибкой инициализации
**Решение**:

- Проверьте, что антивирус не блокирует выполнение
- Убедитесь, что системные требования соблюдены
- Попробуйте запустить скрипт вручную для диагностики

#### Проблема: "Не удается удалить временные файлы"

**Симптомы**: Предупреждение об ошибках при очистке
**Решение**:

- Временные файлы могут остаться в `%TEMP%` каталоге
- Проверьте, не используются ли файлы другими процессами
- Очистите временные файлы вручную при необходимости

### Диагностика

Для диагностики проблем запустите скрипт вручную в PowerShell вместо скрытого режима, чтобы видеть вывод:

```powershell
powershell.exe -File "C:\ClubTools\DiscordBypass\DiscordBypass.ps1"
```

## Безопасность

### Обработка временных файлов

Скрипт создает временные файлы в следующем каталоге:

```
%TEMP%\DiscordBypass_YYYYMMDD_HHMMSS
```

Где `YYYYMMDD_HHMMSS` - это дата и время запуска скрипта.

### Автоматическая очистка

После завершения работы целевого приложения скрипт автоматически:

- Завершает все процессы, запущенные из временной директории
- Удаляет все временные файлы и директории
- Очищает все следы работы инструментов обхода

### Безопасность загрузки

- Перед загрузкой проверяется размер файла (не более 50 МБ по умолчанию)
- Загрузка производится по HTTPS из надежного источника (GitHub)
- Проверяется целостность загруженного архива

### Скрытие процессов

Скрипт запускает обход в скрытом режиме без отображения окон, что:

- Скрывает процесс обхода от пользователей
- Предотвращает случайное закрытие процессов
- Обеспечивает прозрачную работу для пользователей

## Совместимость

### Совместимость с Windows

Скрипт протестирован и совместим с:

- Windows 10 (64-битные и 32-битные версии)
- Windows 11 (64-битные и 32-битные версии)
- Windows 10/11 с последними обновлениями
- Windows в корпоративной среде

### Требования к версии приложений

Скрипт совместим с:

- Стандартной установкой Discord
- Портативной версией Discord
- Discord PTB (Public Test Build)
- Discord Canary
- Любой версией Discord, установленной в стандартные директории
- YouTube и другими сервисами, поддерживаемыми инструментами zapret

### Совместимость с инструментами обхода

Скрипт использует `zapret-discord-youtube-1.8.5` и:

- Автоматически загружает необходимую версию
- Совместим с различными скриптами обхода
- Поддерживает настройку имени скрипта обхода

## Обслуживание

### Обновление скрипта

Для обновления скрипта до новой версии:

1. Проверьте наличие новой версии инструментов обхода на GitHub
2. Обновите значение переменной `$ReleaseUrl` в скрипте
3. При необходимости обновите `$BypassScript` на новый скрипт обхода
4. Протестируйте обновленный скрипт в тестовой среде

### Обновление версии инструментов обхода

Чтобы использовать новую версию `zapret-discord-youtube`:

1. Измените URL в переменной `$ReleaseUrl`:

```powershell
$ReleaseUrl = "https://github.com/Flowseal/zapret-discord-youtube/releases/download/NEW_VERSION/zapret-discord-youtube-NEW_VERSION.zip"
```

2. Измените имя архива и директории извлечения при необходимости:

```powershell
$ZipPath = Join-Path $TempDir "zapret-discord-youtube-NEW_VERSION.zip"
$ExtractDir = Join-Path $TempDir "zapret-discord-youtube-NEW_VERSION"
```

### Резервное копирование

Перед внесением изменений рекомендуется создать резервную копию:

```cmd
copy "C:\ClubTools\DiscordBypass\DiscordBypass.ps1" "C:\ClubTools\DiscordBypass\DiscordBypass.ps1.backup"
```

### Мониторинг работоспособности

Рекомендуется периодически проверять:

- Работоспособность скрипта на разных машинах
- Актуальность URL для загрузки инструментов
- Совместимость с новыми версиями приложений
- Эффективность обхода ограничений

## Примеры использования

### Простой запуск

```powershell
.\DiscordBypass.ps1
```

### Запуск с указанием пути к Discord

```powershell
.\DiscordBypass.ps1 -DiscordPath "C:\Program Files\Discord.exe"
```

### Запуск с другим скриптом обхода

```powershell
.\DiscordBypass.ps1 -BypassScript "windows_service_installer.bat"
```

## Лицензия

Этот проект лицензирован на условиях MIT License - смотрите файл [LICENSE](LICENSE) для получения подробной информации.

## Авторы

- **Flowseal** - оригинальные инструменты обхода (zapret-discord-youtube)
- **Contributors** - скрипт DiscordBypass и сопутствующие инструменты

## Благодарности

- Сообществу разработчиков за инструменты и ресурсы, использованные в этом проекте
- Пользователям, которые тестировали и помогали улучшать функциональность
